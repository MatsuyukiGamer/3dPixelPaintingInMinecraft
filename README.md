# 3dPixelPaintingInMinecraft
在minecraft中生成3d的地图画

实话说这是一个很普通的matlab程序，代码水平简陋但确保无虫。<br>
它可以根据游戏的地图文件（map_i.dat）生成出一个mcfunction文件（minecraft数据包的函数），运行这个mcfuntion函数就可以在minecraft中重建出地图所描绘的地形。<br>
<br>
它最主要的作用是构建立体的像素画。方块之间的相对高度关系编织出三种阴影，我充分利用了地图的51种基色和3种阴影，让地图可以显示出尽量丰富的画质。<br>
153种基色可以让地图（游戏中的物品，而非存档）显示的像素画具有最丰富的的色彩，这远比平板像素画要好。<br>
<br>
关于立体像素画的更多细节可以看这个视频，以及视频简介：<br>
https://www.bilibili.com/video/BV1Ci4y1E7oU
如果想要了解立体地图画的原理也可以仔细阅读一下简介，或者去看一看mcwiki的“地图物品格式”条目——这是我最重要的参考资料<br>


#先介绍一下几个我常用的术语：<br>
1.地图：特指游戏中可以记录地形的物品，不是存档。<br>
2.地图文件：存储地图内容的文件，它们在\saves\存档名称\data\下面，文件名都是map_i.dat。其中i是大于等于0的整数，也就是地图的id。<br>
3.地图色Color：地图文件中存储的数据，每个地图色取值都在0-255，占用一个Byte。地图色是minecraft根据方块id和方块位置计算出来的。<br>
基色Base：顾名思义，基色的基础颜色。基色的取值范围是0-51，minecraft的地图中一共可以显示52种基础颜色，它们分别对应一个基色。除去0代表的透明颜色（虚空），一共有1~51个基色。基色由方块id唯一确定。<br>
4.阴影Depth：阴影的取值范围是0-3，它描述的是方块之间的相对高度。如果一个方块A在地图中，它北侧的方块B比A高，那么A的Depth值为0;如果A与B高度相同，则A的Depth值为1；如果A的高度比B高，那么A的Depth值为2。Depth值为3只能用第三方软件来获得，mc正常录制地图时不会生成这样的地图。<br>
因为地图大小都是128×128像素，所以Color、Base、Depth都是128行、128列的矩阵。水平向左是x+方向，竖直向下是z+方向<br>
地图中每一个方块都有两个用途：表达自己的基色，并调节自己南侧方块的阴影。<br>
5.高度Height：高度矩阵比其他矩阵多一行，尺寸为129×128。高度矩阵的每一个元素都代表了这个位置的方块的绝对高度。某种意义上，阴影是绝对高度的“导数”。地图最北侧的方块仍然需要它们北侧的方块来调节自己的阴影，所以高度矩阵多一行。多出的一行可以用任何种类的不透明方块，它们只起到调节地图最北侧方块阴影的作用，不会被地图记录下来。<br>
6.水列表WaterList：水的阴影与其他方块截然不同。水的阴影与相对高度无关，只取决于自己的深度。然而水仍然可以调节自己南侧方块的阴影（1格深、5格深和7格深三个级别，不能获得第四个阴影），所以将水单独列出来，特殊处理。WaterList的每一列都代表一个水柱，第一行为水的行位置（i），第二行是水的列位置（j），第三行是水柱的顶点坐标，第四行是水柱的最低点坐标。<br>
7.NWPos：导出地图的时候需要确定地图的坐标，NWPos是一个1×3的行向量[x,y,z]，它是地图西北角方块的坐标。默认为[-64,5,-64]。<br>
8.Path：一个字符串，它是导出的mcfuntion的地址。<br>
9.CBL：自定义的方块列表。<br>
<br>
<br>
#v1.0：第一个可以凑活着用的版本<br>
##使用方法：<br>
1.使用第三方的地图画生成器（如mc-map.djfun.de）生成出地图文件map_i.dat。<br>
2.然后用winrar或者其他解压软件直接将它解压（地图文件是gzip压缩的），得到map_i这样一个没用后缀名的文件。<br>
3.启动ReadUnpacked.exe，输入map_i（也就是解压后的文件名），它会提取出Base.txt和Depth.txt，分别是地图的基色矩阵和阴影矩阵。<br>
4.打开matlab，将所有matlab函数移动到\matlab\bin文件夹下（也可以自己创建一个子文件夹），确保这些函数已经被matlab添加到路径中。后面的操作都在matlab中进行。<br>
5.分别复制两个txt的全部内容，粘贴在matlab的命令行窗口中，按enter执行。这样就导入了两个128×128的矩阵，分别为Base和Depth。<br>
6.输入你要生成的mcfuntion的路径，比如：Path='D:\游戏\Minecraft\test.mcfunction'。最好将它存成一个字符串或者字符向量。<br>
7.选好导出所用的Mode（其实是方块列表），输入Mode="Survival_Better"按回车。模式的值可以是"Custom"（传统，适于创造模式）"Survival_Cheaper"（适于生存前期，比较便宜）"Survival_Better"（适于生存后期）"InstBreak"（尽量选择可瞬间破坏的方块）和"Replace"（替换一部分传统方块列表）。不建议使用"Replace"，它还不太完善。我最推荐使用"Survival_Better"。<br>
8.设定地图画的西北角坐标。如果你不了解地图网格，那就输入Pos=[-64,5,-64]。注意坐标的顺序是xyz，Pos应当是行向量。<br>
9.调用EzExport函数。输入EzExport(Base,Depth,Path,Mode,Pos,0)并等待一小会。如果返回一个大于等于16512的数字，说明mcfunction生成成功了。这个数字就是mcfuntion包含的命令数。<br>
10.关闭matlab，将生成的mcfunction移动到存档的数据包中。<br>
11.打开matlab，进入存档，使用/reload命令，再使用/function命令调用刚刚生成的函数。<br>
<br>
<br>
#包含的文件：<br>
1.ReadUnpacked：一个c艹的应用程序，它的用途是提取解压后的地图文件。地图文件都是gzip压缩的，我非常菜搞不懂gzip，所以要先使用winrar或者bandzip手动解压地图文件，得到的文件应该是去掉了.dat后缀的map_i文件。使用ReadUnpacked.exe处理这个文件，得到2个txt，它们就是进行下一步所需的参数。<br>
2.EzExport：方便你生成地图画的函数。它调用了GetHeight.m和MapExport.m这两个函数。<br>
3.GetHeight：将Depth矩阵表示的相对高度转换为Height矩阵的绝对高度，并将水专门列出，特殊处理。<br>
4.MapExport：最终生成mcfuntion的函数。它内置了几种方块列表可供选择。<br>
5.DrawMap：预览将要生成的地图画。<br>
6.MLGHelp：一个提供帮助用的函数。还不是太完善但也可以凑合用。<br>


